<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SDTM Roster Import Tool</title>
    <style>
        :root { --bg: #F2F2F7; --card: #FFFFFF; --accent: #007AFF; --green: #34C759; --red: #FF3B30; --gold: #BF941A; --border: #D1D1D6; --text: #1C1C1E; --subtext: #3A3A3C; }
        body { margin: 0; background: var(--bg); color: var(--text); font-family: -apple-system, system-ui, sans-serif; padding: 30px 20px; }
        .content { max-width: 600px; margin: 0 auto; }
        h1 { font-size: 30px; font-weight: 800; margin: 0 0 4px; }
        .subtitle { color: var(--subtext); font-size: 15px; margin-bottom: 30px; }
        .card { background: var(--card); border-radius: 18px; border: 1px solid var(--border); padding: 24px; margin-bottom: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        label { font-size: 13px; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; color: var(--subtext); display: block; margin-bottom: 8px; }
        input[type="text"] { width: 100%; padding: 14px 16px; border: 2px solid var(--border); border-radius: 12px; font-size: 18px; font-family: monospace; letter-spacing: 2px; box-sizing: border-box; outline: none; }
        input[type="text"]:focus { border-color: var(--accent); }
        .name-list { margin: 0; padding: 0; list-style: none; }
        .name-item { display: flex; align-items: center; justify-content: space-between; padding: 10px 14px; border-bottom: 1px solid var(--bg); font-size: 16px; font-weight: 600; }
        .name-item:last-child { border-bottom: none; }
        .name-item input[type="checkbox"] { width: 20px; height: 20px; cursor: pointer; accent-color: var(--accent); }
        .btn { width: 100%; padding: 18px; border-radius: 14px; border: none; font-size: 19px; font-weight: 700; cursor: pointer; margin-top: 8px; }
        .btn-primary { background: var(--accent); color: white; }
        .btn-primary:disabled { background: #C7C7CC; cursor: not-allowed; }
        .btn-secondary { background: #E5E5EA; color: var(--text); }
        .status { border-radius: 12px; padding: 16px 18px; font-size: 15px; font-weight: 600; margin-top: 16px; display: none; }
        .status-info { background: #E8F2FF; color: #004499; }
        .status-success { background: #F0FFF4; color: #1a7a1a; }
        .status-error { background: #FFF0F0; color: #990000; }
        .count-badge { background: var(--accent); color: white; border-radius: 20px; padding: 2px 10px; font-size: 13px; font-weight: 800; }
        .warning { background: #FFF9E6; border-left: 4px solid var(--gold); padding: 14px 16px; border-radius: 8px; font-size: 14px; margin-bottom: 20px; }
        .select-row { display: flex; gap: 10px; margin-bottom: 10px; }
        .select-btn { flex: 1; padding: 8px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg); font-size: 13px; font-weight: 700; cursor: pointer; color: var(--accent); }
    </style>
</head>
<body>
<div class="content">
    <h1>Roster Import</h1>
    <p class="subtitle">Southern Dutchess Toastmasters &nbsp;·&nbsp; One-time setup tool</p>

```
<div class="warning">
    <strong>⚠ One-time use only.</strong> This tool merges names into your existing Firestore roster — it will not overwrite or delete any names already there. Run once and discard.
</div>

<div class="card">
    <label>Club Sync Code</label>
    <input type="text" id="syncCode" placeholder="XXXX-XXXX" maxlength="9" oninput="formatCode(this)" autocomplete="off" autocorrect="off" autocapitalize="characters" spellcheck="false">
</div>

<div class="card">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
        <label style="margin:0;">Members to Import <span class="count-badge" id="selectedCount">23</span></label>
    </div>
    <div class="select-row">
        <button class="select-btn" onclick="selectAll()">Select All</button>
        <button class="select-btn" onclick="selectNone()">Deselect All</button>
    </div>
    <ul class="name-list" id="nameList"></ul>
</div>

<button class="btn btn-primary" id="importBtn" onclick="runImport()">Push to Cloud</button>
<button class="btn btn-secondary" style="margin-top:10px;" onclick="window.close()">Close Tool</button>

<div class="status" id="status"></div>
```

</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyC2QfJzXrVg9TmUasmtfLbegSlUGmg5JR4",
        authDomain: "sdtm-tm-app.firebaseapp.com",
        projectId: "sdtm-tm-app",
        storageBucket: "sdtm-tm-app.firebasestorage.app",
        messagingSenderId: "429843202069",
        appId: "1:429843202069:web:eec66b741bc3fc90934e1c"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Paid members from Club-Membership20260225.csv — sorted A-Z
    // T.T. Fonseka excluded (UnpaidMember)
    const MEMBERS = [
        "ADRIANA A. HEINKE",
        "ANGELINA COVINGTON",
        "BARBARA MONACO",
        "BRUCE P. MANHEIM",
        "DARREN H. MARSHALL",
        "DEVAKI KRISHNAN",
        "EMMANUEL TRINIDAD",
        "FRANCISCO J. MARTINEZ",
        "JACKIE OPPENHEIM",
        "JANICE R. DIMOCK",
        "JEREMY GONZALEZ",
        "JOSEPH MASELLI",
        "KAHLIL THORPE",
        "KEVIN P. SHANNON",
        "MARIA T. TELMONT",
        "MARKLY A. WILSON",
        "MATTHEW J. TRAVAGLINE",
        "MEKKAT KRISHNAN",
        "MELISSA WOOD",
        "ROBERTA M. ROY",
        "RUTH RAY",
        "ULRIC LESTRADE",
        "WANDA CAMPBELL"
    ];

    function renderList() {
        const ul = document.getElementById('nameList');
        ul.innerHTML = MEMBERS.map((n, i) => `
            <div class="name-item">
                <span>${n}</span>
                <input type="checkbox" id="chk${i}" checked onchange="updateCount()">
            </div>`).join('');
        updateCount();
    }

    function updateCount() {
        const checked = MEMBERS.filter((_, i) => document.getElementById('chk'+i)?.checked).length;
        document.getElementById('selectedCount').innerText = checked;
    }

    function selectAll() { MEMBERS.forEach((_, i) => { const c = document.getElementById('chk'+i); if(c) c.checked = true; }); updateCount(); }
    function selectNone() { MEMBERS.forEach((_, i) => { const c = document.getElementById('chk'+i); if(c) c.checked = false; }); updateCount(); }

    function formatCode(el) {
        let v = el.value.replace(/[^A-Za-z0-9]/g, '').toUpperCase();
        if (v.length > 4) v = v.slice(0,4) + '-' + v.slice(4,8);
        el.value = v;
    }

    function showStatus(msg, type) {
        const el = document.getElementById('status');
        el.className = 'status status-' + type;
        el.innerHTML = msg;
        el.style.display = 'block';
    }

    async function runImport() {
        const code = document.getElementById('syncCode').value.trim().toUpperCase();
        if (code.length !== 9) { showStatus('Please enter a valid 8-character sync code (e.g. ABCD-EF3G).', 'error'); return; }

        const selected = MEMBERS.filter((_, i) => document.getElementById('chk'+i)?.checked);
        if (!selected.length) { showStatus('No members selected.', 'error'); return; }

        const btn = document.getElementById('importBtn');
        btn.disabled = true;
        btn.innerText = 'Importing...';
        showStatus('Connecting to Firestore...', 'info');

        try {
            // Fetch existing doc
            const docRef = db.collection('clubs').doc(code);
            const snap = await docRef.get();

            if (!snap.exists) {
                showStatus(`No club found with sync code <strong>${code}</strong>. Double-check and try again.`, 'error');
                btn.disabled = false; btn.innerText = 'Push to Cloud'; return;
            }

            const existing = snap.data();
            const existingNames = (existing.speakers || []).map(n => n.toUpperCase());

            // Merge — add only names not already present
            const toAdd = selected.filter(n => !existingNames.includes(n));
            const merged = [...existingNames, ...toAdd].sort();

            await docRef.update({
                speakers: merged,
                lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
            });

            const skipped = selected.length - toAdd.length;
            showStatus(
                `✓ Done! <strong>${toAdd.length} member${toAdd.length !== 1 ? 's' : ''} added</strong> to the cloud roster.` +
                (skipped > 0 ? ` ${skipped} already present and skipped.` : '') +
                `<br><br>Open the app → Settings → Clubs → Pull from Cloud to sync to your device.`,
                'success'
            );
            btn.innerText = '✓ Import Complete';
        } catch (e) {
            showStatus('Error: ' + e.message, 'error');
            btn.disabled = false;
            btn.innerText = 'Push to Cloud';
        }
    }

    renderList();
</script>

</body>
</html>